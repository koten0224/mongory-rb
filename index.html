<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: README
  
    &mdash; Documentation by YARD 0.9.37
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "README";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'><h1 id="mongory-rb">Mongory-rb</h1>

<p>A Mongo-like in-memory query DSL for Ruby.</p>

<p>Mongory lets you filter and query in-memory collections using syntax and semantics similar to MongoDB. It is designed for expressive chaining, symbolic operators, and composable matchers.</p>

<h2 id="positioning">Positioning</h2>

<p>Mongory is designed to serve two types of users:</p>

<ol>
<li><p>For MongoDB users:</p>

<ul>
<li>Seamless integration with familiar query syntax</li>
<li>Extends query capabilities for non-indexed fields</li>
<li>No additional learning cost</li>
</ul></li>
<li><p>For non-MongoDB users:</p>

<ul>
<li>Initial learning cost for MongoDB-style syntax</li>
<li>Long-term benefits:

<ul>
<li>Improved code readability</li>
<li>Better development efficiency</li>
<li>Lower maintenance costs</li>
</ul></li>
<li>Ideal for teams valuing code quality and maintainability</li>
</ul></li>
</ol>

<h2 id="requirements">Requirements</h2>

<ul>
<li>Ruby &gt;= 2.6.0</li>
<li>No external database required</li>
</ul>

<h2 id="quick-start">Quick Start</h2>

<h3 id="installation">Installation</h3>

<h4 id="rails-generator">Rails Generator</h4>

<p>You can install a starter configuration with:</p>

<pre class="code bash"><code class="bash">rails g mongory:install
</code></pre>

<p>This will generate <code>config/initializers/mongory.rb</code> and set up:</p>

<ul>
<li>Optional symbol operator snippets (e.g. <code>:age.gt =&gt; 18</code>)</li>
<li>Class registration (e.g. <code>Array</code>, <code>ActiveRecord::Relation</code>, etc.)</li>
<li>Custom value/key converters for your ORM</li>
</ul>

<p>Or install manually:</p>

<pre class="code bash"><code class="bash">gem install mongory
</code></pre>

<p>Or add to your Gemfile:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_gem'>gem</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>mongory</span><span class='tstring_end'>&#39;</span></span>
</code></pre>

<h3 id="basic-usage">Basic Usage</h3>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_records'>records</span> <span class='op'>=</span> <span class='lbracket'>[</span>
  <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>name</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Jack</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>age</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='int'>18</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>gender</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>M</span><span class='tstring_end'>&#39;</span></span> <span class='rbrace'>}</span><span class='comma'>,</span>
  <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>name</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Jill</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>age</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='int'>15</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>gender</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>F</span><span class='tstring_end'>&#39;</span></span> <span class='rbrace'>}</span><span class='comma'>,</span>
  <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>name</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Bob</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>  <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>age</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='int'>21</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>gender</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>M</span><span class='tstring_end'>&#39;</span></span> <span class='rbrace'>}</span><span class='comma'>,</span>
  <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>name</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Mary</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>age</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='int'>18</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>gender</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>F</span><span class='tstring_end'>&#39;</span></span> <span class='rbrace'>}</span>
<span class='rbracket'>]</span>

<span class='comment'># Basic query with conditions
</span><span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_records'>records</span><span class='period'>.</span><span class='id identifier rubyid_mongory'>mongory</span>
  <span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:age</span><span class='period'>.</span><span class='id identifier rubyid_gte'>gte</span> <span class='op'>=&gt;</span> <span class='int'>18</span><span class='rparen'>)</span>
  <span class='period'>.</span><span class='id identifier rubyid_or'>or</span><span class='lparen'>(</span><span class='lbrace'>{</span> <span class='symbol'>:name</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>J</span><span class='regexp_end'>/</span></span> <span class='rbrace'>}</span><span class='comma'>,</span> <span class='lbrace'>{</span> <span class='symbol'>:name</span><span class='period'>.</span><span class='id identifier rubyid_eq'>eq</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Bob</span><span class='tstring_end'>&#39;</span></span> <span class='rbrace'>}</span><span class='rparen'>)</span>

<span class='comment'># Using limit to restrict results
</span><span class='comment'># Note: limit executes immediately and affects subsequent conditions
</span><span class='id identifier rubyid_limited'>limited</span> <span class='op'>=</span> <span class='id identifier rubyid_records'>records</span><span class='period'>.</span><span class='id identifier rubyid_mongory'>mongory</span>
  <span class='period'>.</span><span class='id identifier rubyid_limit'>limit</span><span class='lparen'>(</span><span class='int'>2</span><span class='rparen'>)</span>                    <span class='comment'># Only process first 2 records
</span>  <span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:age</span><span class='period'>.</span><span class='id identifier rubyid_gte'>gte</span> <span class='op'>=&gt;</span> <span class='int'>18</span><span class='rparen'>)</span>       <span class='comment'># Conditions apply to limited set
</span></code></pre>

<h3 id="integration-with-mongodb">Integration with MongoDB</h3>

<p>Mongory is designed to complement MongoDB, not replace it. Here&#39;s how to use them together:</p>

<ol>
<li><p>Use MongoDB for:</p>

<ul>
<li>Queries with indexes</li>
<li>Persistent data operations</li>
<li>Large-scale data processing</li>
</ul></li>
<li><p>Use Mongory for:</p>

<ul>
<li>Queries without indexes</li>
<li>Complex in-memory calculations</li>
<li>Temporary data filtering needs</li>
</ul></li>
</ol>

<p>Example:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># First use MongoDB for indexed queries
</span><span class='id identifier rubyid_users'>users</span> <span class='op'>=</span> <span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>status:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>active</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>  <span class='comment'># Uses MongoDB index
</span>
<span class='comment'># Then use Mongory for non-indexed fields
</span><span class='id identifier rubyid_active_users'>active_users</span> <span class='op'>=</span> <span class='id identifier rubyid_users'>users</span><span class='period'>.</span><span class='id identifier rubyid_mongory'>mongory</span>
  <span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:last_login</span><span class='period'>.</span><span class='id identifier rubyid_gte'>gte</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='period'>.</span><span class='id identifier rubyid_week'>week</span><span class='period'>.</span><span class='id identifier rubyid_ago'>ago</span><span class='rparen'>)</span>  <span class='comment'># No index on last_login
</span>  <span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:tags</span><span class='period'>.</span><span class='id identifier rubyid_elem_match'>elem_match</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='symbol'>:name</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>ruby</span><span class='tstring_end'>&#39;</span></span> <span class='rbrace'>}</span><span class='rparen'>)</span>  <span class='comment'># Complex array query
</span></code></pre>

<h3 id="creating-custom-matchers">Creating Custom Matchers</h3>

<h4 id="using-the-generator">Using the Generator</h4>

<p>You can generate a new matcher using:</p>

<pre class="code bash"><code class="bash">rails g mongory:matcher class_in
</code></pre>

<p>This will:</p>

<ol>
<li>Create a new matcher file at <code>lib/mongory/matchers/class_in_matcher.rb</code></li>
<li>Create a spec file at <code>spec/mongory/matchers/class_in_matcher_spec.rb</code></li>
<li>Update <code>config/initializers/mongory.rb</code> to require the new matcher</li>
</ol>

<p>The generated matcher will:</p>

<ul>
<li>Be named <code>ClassInMatcher</code></li>
<li>Register the operator as <code>$classIn</code></li>
<li>Be available as <code>:class_in</code> in queries</li>
</ul>

<p>Example usage of the generated matcher:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_records'>records</span><span class='period'>.</span><span class='id identifier rubyid_mongory'>mongory</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:value</span><span class='period'>.</span><span class='id identifier rubyid_class_in'>class_in</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='const'>Integer</span><span class='comma'>,</span> <span class='const'>String</span><span class='rbracket'>]</span><span class='rparen'>)</span>
</code></pre>

<h4 id="manual-creation">Manual Creation</h4>

<p>If you prefer to create matchers manually, here&#39;s an example:</p>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>ClassInMatcher</span> <span class='op'>&lt;</span> <span class='const'><span class='object_link'><a href="Mongory.html" title="Mongory (module)">Mongory</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Mongory/Matchers.html" title="Mongory::Matchers (module)">Matchers</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Mongory/Matchers/AbstractMatcher.html" title="Mongory::Matchers::AbstractMatcher (class)">AbstractMatcher</a></span></span>
  <span class='kw'>def</span> <span class='id identifier rubyid_match'>match</span><span class='lparen'>(</span><span class='id identifier rubyid_subject'>subject</span><span class='rparen'>)</span>
    <span class='ivar'>@condition</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_klass'>klass</span><span class='op'>|</span> <span class='id identifier rubyid_subject'>subject</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='id identifier rubyid_klass'>klass</span><span class='rparen'>)</span> <span class='rbrace'>}</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_check_validity!'>check_validity!</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>TypeError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>$classIn needs an array.</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>unless</span> <span class='ivar'>@condition</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Array</span><span class='rparen'>)</span>
    <span class='ivar'>@condition</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_klass'>klass</span><span class='op'>|</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>TypeError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>$classIn needs an array of class.</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_klass'>klass</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Class</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='const'><span class='object_link'><a href="Mongory.html" title="Mongory (module)">Mongory</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Mongory/Matchers.html" title="Mongory::Matchers (module)">Matchers</a></span></span><span class='period'>.</span><span class='id identifier rubyid_register'><span class='object_link'><a href="Mongory/Matchers.html#register-class_method" title="Mongory::Matchers.register (method)">register</a></span></span><span class='lparen'>(</span><span class='symbol'>:class_in</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>$classIn</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='const'>ClassInMatcher</span><span class='rparen'>)</span>

<span class='lbracket'>[</span><span class='lbrace'>{</span><span class='label'>a:</span> <span class='int'>1</span><span class='rbrace'>}</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_mongory'>mongory</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:a</span><span class='period'>.</span><span class='id identifier rubyid_class_in'>class_in</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='const'>Integer</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
<span class='comment'># =&gt; { a: 1 }
</span></code></pre>

<p>You can define any matcher behavior and attach it to a <code>$operator</code> of your choice.
Matchers can be composed, validated, and traced just like built-in ones.</p>

<h3 id="handling-dots-in-field-names">Handling Dots in Field Names</h3>

<p>Mongory supports field names containing dots, which require escaping:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># Sample data
</span><span class='id identifier rubyid_records'>records</span> <span class='op'>=</span> <span class='lbracket'>[</span>
  <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>user.name</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>John</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>age</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>25</span> <span class='rbrace'>}</span><span class='comma'>,</span>  <span class='comment'># Field name contains a dot
</span>  <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>user</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Bob</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>age</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>30</span> <span class='rbrace'>}</span>  <span class='comment'># Nested field
</span><span class='rbracket'>]</span>

<span class='comment'># Field name contains a dot
</span><span class='id identifier rubyid_records'>records</span><span class='period'>.</span><span class='id identifier rubyid_mongory'>mongory</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>user\\.name</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>John</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>  <span class='comment'># Two backslashes needed with double quotes
</span><span class='comment'># =&gt; [{ &quot;user.name&quot; =&gt; &quot;John&quot;, &quot;age&quot; =&gt; 25 }]
</span>
<span class='comment'># or
</span><span class='id identifier rubyid_records'>records</span><span class='period'>.</span><span class='id identifier rubyid_mongory'>mongory</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>user\.name</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>John</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>   <span class='comment'># One backslash needed with single quotes
</span><span class='comment'># =&gt; [{ &quot;user.name&quot; =&gt; &quot;John&quot;, &quot;age&quot; =&gt; 25 }]
</span>
<span class='comment'># Nested field (no escaping needed)
</span><span class='id identifier rubyid_records'>records</span><span class='period'>.</span><span class='id identifier rubyid_mongory'>mongory</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>user.name</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Bob</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='comment'># =&gt; [{ &quot;user&quot; =&gt; { &quot;name&quot; =&gt; &quot;Bob&quot; }, &quot;age&quot; =&gt; 30 }]
</span></code></pre>

<p>Note:</p>

<ul>
<li>With double quotes, backslashes need to be escaped (<code>\\</code>)</li>
<li>With single quotes, backslashes don&#39;t need to be escaped (<code>\</code>)</li>
<li>This behavior is consistent with MongoDB&#39;s query syntax</li>
<li>The escaped dot pattern (<code>\.</code>) matches fields where the dot is part of the field name</li>
<li>The unescaped dot pattern (<code>.</code>) matches nested fields in the document structure</li>
</ul>

<h3 id="advanced-usage">Advanced Usage</h3>

<h4 id="complex-queries">Complex Queries</h4>

<pre class="code ruby"><code class="ruby"><span class='comment'># Nested conditions
</span><span class='id identifier rubyid_users'>users</span><span class='period'>.</span><span class='id identifier rubyid_mongory'>mongory</span>
  <span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span>
    <span class='symbol'>:age</span><span class='period'>.</span><span class='id identifier rubyid_gte'>gte</span> <span class='op'>=&gt;</span> <span class='int'>18</span><span class='comma'>,</span>
    <span class='symbol'>:$or</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span>
      <span class='lbrace'>{</span> <span class='symbol'>:status</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>active</span><span class='tstring_end'>&#39;</span></span> <span class='rbrace'>}</span><span class='comma'>,</span>
      <span class='lbrace'>{</span> <span class='symbol'>:status</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>pending</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbol'>:created_at</span><span class='period'>.</span><span class='id identifier rubyid_gte'>gte</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='period'>.</span><span class='id identifier rubyid_week'>week</span><span class='period'>.</span><span class='id identifier rubyid_ago'>ago</span> <span class='rbrace'>}</span>
    <span class='rbracket'>]</span>
  <span class='rparen'>)</span>

<span class='comment'># Using any_of for nested OR conditions
</span><span class='id identifier rubyid_users'>users</span><span class='period'>.</span><span class='id identifier rubyid_mongory'>mongory</span>
  <span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:age</span><span class='period'>.</span><span class='id identifier rubyid_gte'>gte</span> <span class='op'>=&gt;</span> <span class='int'>18</span><span class='rparen'>)</span>
  <span class='period'>.</span><span class='id identifier rubyid_any_of'>any_of</span><span class='lparen'>(</span>
    <span class='lbrace'>{</span> <span class='symbol'>:status</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>active</span><span class='tstring_end'>&#39;</span></span> <span class='rbrace'>}</span><span class='comma'>,</span>
    <span class='lbrace'>{</span> <span class='symbol'>:status</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>pending</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbol'>:created_at</span><span class='period'>.</span><span class='id identifier rubyid_gte'>gte</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='period'>.</span><span class='id identifier rubyid_week'>week</span><span class='period'>.</span><span class='id identifier rubyid_ago'>ago</span> <span class='rbrace'>}</span>
  <span class='rparen'>)</span>

<span class='comment'># Array operations
</span><span class='id identifier rubyid_posts'>posts</span><span class='period'>.</span><span class='id identifier rubyid_mongory'>mongory</span>
  <span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:tags</span><span class='period'>.</span><span class='id identifier rubyid_elem_match'>elem_match</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='symbol'>:name</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>ruby</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbol'>:priority</span><span class='period'>.</span><span class='id identifier rubyid_gt'>gt</span> <span class='op'>=&gt;</span> <span class='int'>5</span> <span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:comments</span><span class='period'>.</span><span class='id identifier rubyid_every'>every</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='symbol'>:approved</span> <span class='op'>=&gt;</span> <span class='kw'>true</span> <span class='rbrace'>}</span><span class='rparen'>)</span>
</code></pre>

<h4 id="integration-with-activerecord">Integration with ActiveRecord</h4>

<pre class="code ruby"><code class="ruby"><span class='kw'>class</span> <span class='const'>User</span> <span class='op'>&lt;</span> <span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>Base</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_active_friends'>active_friends</span>
    <span class='id identifier rubyid_friends'>friends</span><span class='period'>.</span><span class='id identifier rubyid_mongory'>mongory</span>
      <span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:status</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>active</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
      <span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:last_seen</span><span class='period'>.</span><span class='id identifier rubyid_gte'>gte</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='period'>.</span><span class='id identifier rubyid_day'>day</span><span class='period'>.</span><span class='id identifier rubyid_ago'>ago</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<h3 id="query-api-reference">Query API Reference</h3>

<h4 id="registering-models">Registering Models</h4>

<p>To allow calling <code>.mongory</code> on collections, use <code>register</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='const'><span class='object_link'><a href="Mongory.html" title="Mongory (module)">Mongory</a></span></span><span class='period'>.</span><span class='id identifier rubyid_register'><span class='object_link'><a href="Mongory.html#register-class_method" title="Mongory.register (method)">register</a></span></span><span class='lparen'>(</span><span class='const'>Array</span><span class='rparen'>)</span>
<span class='const'><span class='object_link'><a href="Mongory.html" title="Mongory (module)">Mongory</a></span></span><span class='period'>.</span><span class='id identifier rubyid_register'><span class='object_link'><a href="Mongory.html#register-class_method" title="Mongory.register (method)">register</a></span></span><span class='lparen'>(</span><span class='const'>ActiveRecord</span><span class='op'>::</span><span class='const'>Relation</span><span class='rparen'>)</span>
<span class='const'>User</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>status:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>active</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_mongory'>mongory</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:age</span><span class='period'>.</span><span class='id identifier rubyid_gte'>gte</span> <span class='op'>=&gt;</span> <span class='int'>18</span><span class='comma'>,</span> <span class='symbol'>:name</span><span class='period'>.</span><span class='id identifier rubyid_regex'>regex</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>^S.+</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
</code></pre>

<p>This injects a <code>.mongory</code> method via an internal extension module.</p>

<p>Internally, the query is compiled into a matcher tree using the <code>QueryMatcher</code> and <code>ConditionConverter</code>.</p>

<table><thead>
<tr>
<th>Method</th>
<th>Description</th>
<th>Example</th>
</tr>
</thead><tbody>
<tr>
<td><code>where</code></td>
<td>Adds a condition to filter records</td>
<td><code>where(age: { :$gte =&gt; 18 })</code></td>
</tr>
<tr>
<td><code>not</code></td>
<td>Adds a negated condition</td>
<td><code>not(age: { :$lt =&gt; 18 })</code></td>
</tr>
<tr>
<td><code>and</code></td>
<td>Combines conditions with <code>$and</code></td>
<td><code>and({ age: { :$gte =&gt; 18 } }, { name: /J/ })</code></td>
</tr>
<tr>
<td><code>or</code></td>
<td>Combines conditions with <code>$or</code></td>
<td><code>or({ age: { :$gte =&gt; 18 } }, { name: /J/ })</code></td>
</tr>
<tr>
<td><code>any_of</code></td>
<td>Combines conditions with <code>$or</code> inside an <code>$and</code> block</td>
<td><code>any_of({ age: { :$gte =&gt; 18 } }, { name: /J/ })</code></td>
</tr>
<tr>
<td><code>in</code></td>
<td>Checks if a value is in a set</td>
<td><code>in(age: [18, 19, 20])</code></td>
</tr>
<tr>
<td><code>nin</code></td>
<td>Checks if a value is not in a set</td>
<td><code>nin(age: [18, 19, 20])</code></td>
</tr>
<tr>
<td><code>limit</code></td>
<td>Limits the number of records returned. This method executes immediately and affects subsequent conditions.</td>
<td><code>limit(2)</code></td>
</tr>
<tr>
<td><code>pluck</code></td>
<td>Extracts selected fields from matching records</td>
<td><code>pluck(:name)</code></td>
</tr>
<tr>
<td><code>with_context</code></td>
<td>Sets a custom context for the query. Useful for controlling data conversion and sharing configuration across matchers.</td>
<td><code>with_context(merchant: merchant)</code></td>
</tr>
</tbody></table>

<h4 id="context-configuration">Context Configuration</h4>

<p>The <code>with_context</code> method allows you to customize the query execution environment:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># Share configuration across matchers
</span><span class='id identifier rubyid_records'>records</span><span class='period'>.</span><span class='id identifier rubyid_mongory'>mongory</span>
  <span class='period'>.</span><span class='id identifier rubyid_with_context'>with_context</span><span class='lparen'>(</span><span class='label'>custom_option:</span> <span class='kw'>true</span><span class='rparen'>)</span>
  <span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:status</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>active</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:age</span><span class='period'>.</span><span class='id identifier rubyid_gte'>gte</span> <span class='op'>=&gt;</span> <span class='int'>18</span><span class='rparen'>)</span>
</code></pre>

<p>This will share a mutatable, but stable context object to all matchers in matcher tree.
To get your custom option, using <code>@context.config</code> in your custom matcher.</p>

<h3 id="debugging-queries">Debugging Queries</h3>

<p>You can use <code>explain</code> to visualize the matcher tree structure:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_records'>records</span> <span class='op'>=</span> <span class='lbracket'>[</span>
  <span class='lbrace'>{</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>John</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>age:</span> <span class='int'>25</span><span class='comma'>,</span> <span class='label'>status:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>active</span><span class='tstring_end'>&#39;</span></span> <span class='rbrace'>}</span><span class='comma'>,</span>
  <span class='lbrace'>{</span> <span class='label'>name:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Jane</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='label'>age:</span> <span class='int'>30</span><span class='comma'>,</span> <span class='label'>status:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>inactive</span><span class='tstring_end'>&#39;</span></span> <span class='rbrace'>}</span>
<span class='rbracket'>]</span>

<span class='id identifier rubyid_query'>query</span> <span class='op'>=</span> <span class='id identifier rubyid_records'>records</span><span class='period'>.</span><span class='id identifier rubyid_mongory'>mongory</span>
  <span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:age</span><span class='period'>.</span><span class='id identifier rubyid_gte'>gte</span> <span class='op'>=&gt;</span> <span class='int'>18</span><span class='rparen'>)</span>
  <span class='period'>.</span><span class='id identifier rubyid_any_of'>any_of</span><span class='lparen'>(</span>
    <span class='lbrace'>{</span> <span class='symbol'>:status</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>active</span><span class='tstring_end'>&#39;</span></span> <span class='rbrace'>}</span><span class='comma'>,</span>
    <span class='lbrace'>{</span> <span class='symbol'>:name</span><span class='period'>.</span><span class='id identifier rubyid_regex'>regex</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^J</span><span class='regexp_end'>/</span></span> <span class='rbrace'>}</span>
  <span class='rparen'>)</span>

<span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_explain'>explain</span>
</code></pre>

<p>Output:</p>

<pre class="code ruby"><code class="ruby">And: {&quot;age&quot;=&gt;{&quot;$gte&quot;=&gt;18}, &quot;$or&quot;=&gt;[{&quot;status&quot;=&gt;&quot;active&quot;}, {&quot;name&quot;=&gt;{&quot;$regex&quot;=&gt;/^J/}}]}
├─ Field: &quot;age&quot; to match: {&quot;$gte&quot;=&gt;18}
│  └─ Gte: 18
└─ Or: [{&quot;status&quot;=&gt;&quot;active&quot;}, {&quot;name&quot;=&gt;{&quot;$regex&quot;=&gt;/^J/}}]
   ├─ Field: &quot;status&quot; to match: &quot;active&quot;
   │  └─ Eq: &quot;active&quot;
   └─ Field: &quot;name&quot; to match: {&quot;$regex&quot;=&gt;/^J/}
      └─ Regex: /^J/
</code></pre>

<p>This helps you understand how your query is being processed and can be useful for debugging complex conditions.</p>

<p>Or use the debugger for detailed matching process:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># Enable debugging
</span><span class='const'><span class='object_link'><a href="Mongory.html" title="Mongory (module)">Mongory</a></span></span><span class='period'>.</span><span class='id identifier rubyid_debugger'><span class='object_link'><a href="Mongory.html#debugger-class_method" title="Mongory.debugger (method)">debugger</a></span></span><span class='period'>.</span><span class='id identifier rubyid_enable'><span class='object_link'><a href="Mongory/Utils/Debugger.html#enable-instance_method" title="Mongory::Utils::Debugger#enable (method)">enable</a></span></span>

<span class='comment'># Execute your query
</span><span class='id identifier rubyid_query'>query</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="Mongory.html" title="Mongory (module)">Mongory</a></span></span><span class='period'>.</span><span class='id identifier rubyid_build_query'><span class='object_link'><a href="Mongory.html#build_query-class_method" title="Mongory.build_query (method)">build_query</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_users'>users</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_where'><span class='object_link'><a href="Mongory/QueryBuilder.html#where-instance_method" title="Mongory::QueryBuilder#where (method)">where</a></span></span><span class='lparen'>(</span><span class='label'>age:</span> <span class='lbrace'>{</span> <span class='symbol'>:$gt</span> <span class='op'>=&gt;</span> <span class='int'>18</span> <span class='rbrace'>}</span><span class='rparen'>)</span>
<span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_user'>user</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_user'>user</span>
<span class='kw'>end</span>

<span class='comment'># Display the debug trace
</span><span class='const'><span class='object_link'><a href="Mongory.html" title="Mongory (module)">Mongory</a></span></span><span class='period'>.</span><span class='id identifier rubyid_debugger'><span class='object_link'><a href="Mongory.html#debugger-class_method" title="Mongory.debugger (method)">debugger</a></span></span><span class='period'>.</span><span class='id identifier rubyid_display'><span class='object_link'><a href="Mongory/Utils/Debugger.html#display-instance_method" title="Mongory::Utils::Debugger#display (method)">display</a></span></span>
</code></pre>

<p>The debug output will show detailed matching process with full class names:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>QueryMatcher</span> <span class='const'>Matched</span><span class='comma'>,</span> <span class='label'>condition:</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>age</span><span class='tstring_end'>&quot;</span></span><span class='op'>=&gt;</span><span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$gt</span><span class='tstring_end'>&quot;</span></span><span class='op'>=&gt;</span><span class='int'>18</span><span class='rbrace'>}</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='label'>record:</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>age</span><span class='tstring_end'>&quot;</span></span><span class='op'>=&gt;</span><span class='int'>25</span><span class='rbrace'>}</span>
  <span class='const'>AndMatcher</span> <span class='const'>Matched</span><span class='comma'>,</span> <span class='label'>condition:</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>age</span><span class='tstring_end'>&quot;</span></span><span class='op'>=&gt;</span><span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$gt</span><span class='tstring_end'>&quot;</span></span><span class='op'>=&gt;</span><span class='int'>18</span><span class='rbrace'>}</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='label'>record:</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>age</span><span class='tstring_end'>&quot;</span></span><span class='op'>=&gt;</span><span class='int'>25</span><span class='rbrace'>}</span>
    <span class='const'>FieldMatcher</span> <span class='const'>Matched</span><span class='comma'>,</span> <span class='label'>condition:</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>$gt</span><span class='tstring_end'>&quot;</span></span><span class='op'>=&gt;</span><span class='int'>18</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='label'>field:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>age</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>record:</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>age</span><span class='tstring_end'>&quot;</span></span><span class='op'>=&gt;</span><span class='int'>25</span><span class='rbrace'>}</span>
      <span class='const'>GtMatcher</span> <span class='const'>Matched</span><span class='comma'>,</span> <span class='label'>condition:</span> <span class='int'>18</span><span class='comma'>,</span> <span class='label'>record:</span> <span class='int'>25</span>
</code></pre>

<p>The debug output includes:</p>

<ul>
<li>The matcher tree structure with full class names</li>
<li>Each matcher&#39;s condition and record value</li>
<li>Color-coded results (green for matched, red for mismatched, purple for errors)</li>
<li>Field names highlighted in gray background</li>
<li>Detailed matching process for each record</li>
</ul>

<h3 id="performance-considerations">Performance Considerations</h3>

<ol>
<li><p><strong>Memory Usage</strong></p>

<ul>
<li>Mongory operates entirely in memory</li>
<li>Consider your data size and memory constraints</li>
<li>Proc-based implementation reduces memory usage</li>
<li>Context system provides better memory management</li>
</ul></li>
<li><p><strong>Query Optimization</strong></p>

<ul>
<li>Complex conditions are evaluated in sequence</li>
<li>Use <code>explain</code> to analyze query performance</li>
<li>Empty conditions are optimized with cached Procs</li>
<li>Context system allows fine-grained control over conversion</li>
</ul></li>
<li><p><strong>Benchmarks</strong></p>

<pre class="code ruby"><code class="ruby"><span class='comment'># Simple query (1000 records)
</span><span class='id identifier rubyid_records'>records</span><span class='period'>.</span><span class='id identifier rubyid_mongory'>mongory</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:age</span><span class='period'>.</span><span class='id identifier rubyid_gte'>gte</span> <span class='op'>=&gt;</span> <span class='int'>18</span><span class='rparen'>)</span> <span class='comment'># ~0.8ms
</span>
<span class='comment'># Complex query (1000 records)
</span><span class='id identifier rubyid_records'>records</span><span class='period'>.</span><span class='id identifier rubyid_mongory'>mongory</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:$or</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='lbrace'>{</span><span class='symbol'>:age</span><span class='period'>.</span><span class='id identifier rubyid_gte'>gte</span> <span class='op'>=&gt;</span> <span class='int'>18</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='symbol'>:status</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>active</span><span class='tstring_end'>&#39;</span></span><span class='rbrace'>}</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='comment'># ~0.9ms
</span>
<span class='comment'># Simple query (10000 records)
</span><span class='id identifier rubyid_records'>records</span><span class='period'>.</span><span class='id identifier rubyid_mongory'>mongory</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:age</span><span class='period'>.</span><span class='id identifier rubyid_gte'>gte</span> <span class='op'>=&gt;</span> <span class='int'>18</span><span class='rparen'>)</span> <span class='comment'># ~6.5ms
</span>
<span class='comment'># Complex query (10000 records)
</span><span class='id identifier rubyid_records'>records</span><span class='period'>.</span><span class='id identifier rubyid_mongory'>mongory</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:$or</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='lbrace'>{</span><span class='symbol'>:age</span><span class='period'>.</span><span class='id identifier rubyid_gte'>gte</span> <span class='op'>=&gt;</span> <span class='int'>18</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='symbol'>:status</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>active</span><span class='tstring_end'>&#39;</span></span><span class='rbrace'>}</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='comment'># ~7.5ms
</span>
<span class='comment'># Simple query (100000 records)
</span><span class='id identifier rubyid_records'>records</span><span class='period'>.</span><span class='id identifier rubyid_mongory'>mongory</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:age</span><span class='period'>.</span><span class='id identifier rubyid_gte'>gte</span> <span class='op'>=&gt;</span> <span class='int'>18</span><span class='rparen'>)</span> <span class='comment'># ~64.7ms
</span>
<span class='comment'># Complex query (100000 records)
</span><span class='id identifier rubyid_records'>records</span><span class='period'>.</span><span class='id identifier rubyid_mongory'>mongory</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:$or</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='lbrace'>{</span><span class='symbol'>:age</span><span class='period'>.</span><span class='id identifier rubyid_gte'>gte</span> <span class='op'>=&gt;</span> <span class='int'>18</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='symbol'>:status</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>active</span><span class='tstring_end'>&#39;</span></span><span class='rbrace'>}</span><span class='rbracket'>]</span><span class='rparen'>)</span> <span class='comment'># ~75.0ms
</span>
<span class='comment'># Complex query with fast mode (100000 records)
</span><span class='id identifier rubyid_records'>records</span><span class='period'>.</span><span class='id identifier rubyid_mongory'>mongory</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:$or</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='lbrace'>{</span><span class='symbol'>:age</span><span class='period'>.</span><span class='id identifier rubyid_gte'>gte</span> <span class='op'>=&gt;</span> <span class='int'>18</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='symbol'>:status</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>active</span><span class='tstring_end'>&#39;</span></span><span class='rbrace'>}</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_fast'>fast</span> <span class='comment'># ~42.8ms, about 3x of plain ruby
</span></code></pre></li>
</ol>

<p>Note: Performance varies based on:</p>

<ul>
<li>Data size</li>
<li>Query complexity</li>
<li>Hardware specifications</li>
<li>Ruby version</li>
</ul>

<p>Test in your environment to determine if performance meets your needs.</p>

<h3 id="supported-operators">Supported Operators</h3>

<table><thead>
<tr>
<th>Category</th>
<th>Operators</th>
</tr>
</thead><tbody>
<tr>
<td>Comparison</td>
<td><code>$eq</code>, <code>$ne</code>, <code>$gt</code>, <code>$gte</code>, <code>$lt</code>, <code>$lte</code></td>
</tr>
<tr>
<td>Set</td>
<td><code>$in</code>, <code>$nin</code></td>
</tr>
<tr>
<td>Boolean</td>
<td><code>$and</code>, <code>$or</code>, <code>$not</code></td>
</tr>
<tr>
<td>Pattern</td>
<td><code>$regex</code></td>
</tr>
<tr>
<td>Presence</td>
<td><code>$exists</code>, <code>$present</code></td>
</tr>
<tr>
<td>Nested Match</td>
<td><code>$elemMatch</code>, <code>$every</code></td>
</tr>
</tbody></table>

<p>Note: Some operators are Mongory-specific and not available in MongoDB:</p>

<ul>
<li><code>$present</code>: Checks if a field is considered &quot;present&quot; (not nil, not empty, not KEY_NOT_FOUND)

<ul>
<li>Similar to <code>$exists</code> but evaluates truthiness of the value</li>
<li>Example: <code>where(:name.present =&gt; true)</code></li>
</ul></li>
<li><code>$every</code>: Checks if all elements in an array match the given condition

<ul>
<li>Similar to <code>$elemMatch</code> but requires all elements to match</li>
<li>Example: <code>where(:tags.every =&gt; { :priority.gt =&gt; 5 })</code></li>
</ul></li>
</ul>

<p>Example:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># $present: Check if field is present (not nil, not empty)
</span><span class='id identifier rubyid_records'>records</span><span class='period'>.</span><span class='id identifier rubyid_mongory'>mongory</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:name</span><span class='period'>.</span><span class='id identifier rubyid_present'>present</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rparen'>)</span>  <span class='comment'># name is present
</span><span class='id identifier rubyid_records'>records</span><span class='period'>.</span><span class='id identifier rubyid_mongory'>mongory</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:name</span><span class='period'>.</span><span class='id identifier rubyid_present'>present</span> <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='rparen'>)</span> <span class='comment'># name is not present
</span>
<span class='comment'># $every: Check if all array elements match condition
</span><span class='id identifier rubyid_records'>records</span><span class='period'>.</span><span class='id identifier rubyid_mongory'>mongory</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:tags</span><span class='period'>.</span><span class='id identifier rubyid_every'>every</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='symbol'>:priority</span><span class='period'>.</span><span class='id identifier rubyid_gt'>gt</span> <span class='op'>=&gt;</span> <span class='int'>5</span> <span class='rbrace'>}</span><span class='rparen'>)</span>  <span class='comment'># all tags have priority &gt; 5
</span></code></pre>

<h2 id="faq">FAQ</h2>

<h3 id="q-how-does-mongory-compare-to-mongodb">Q: How does Mongory compare to MongoDB?</h3>

<p>A: Mongory provides similar query syntax but operates entirely in memory. It&#39;s ideal for:</p>

<ul>
<li>Small to medium datasets</li>
<li>Complex in-memory filtering</li>
<li>Testing MongoDB-like queries without a database</li>
</ul>

<h3 id="q-can-i-use-mongory-with-large-datasets">Q: Can I use Mongory with large datasets?</h3>

<p>A: Yes, but consider:</p>

<ul>
<li>Memory usage</li>
<li>Query complexity</li>
<li>Caching strategies</li>
<li>Using <code>limit</code> early in the chain</li>
</ul>

<h3 id="q-how-do-i-handle-errors">Q: How do I handle errors?</h3>

<pre class="code ruby"><code class="ruby"><span class='kw'>begin</span>
  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_records'>records</span><span class='period'>.</span><span class='id identifier rubyid_mongory'>mongory</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>invalid:</span> <span class='symbol'>:condition</span><span class='rparen'>)</span>
<span class='kw'>rescue</span> <span class='const'><span class='object_link'><a href="Mongory.html" title="Mongory (module)">Mongory</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Mongory/Error.html" title="Mongory::Error (class)">Error</a></span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
  <span class='comment'># Handle error
</span><span class='kw'>end</span>
</code></pre>

<h2 id="troubleshooting">Troubleshooting</h2>

<ol>
<li><p><strong>Debugging Queries</strong></p>

<pre class="code ruby"><code class="ruby"><span class='const'><span class='object_link'><a href="Mongory.html" title="Mongory (module)">Mongory</a></span></span><span class='period'>.</span><span class='id identifier rubyid_debugger'><span class='object_link'><a href="Mongory.html#debugger-class_method" title="Mongory.debugger (method)">debugger</a></span></span><span class='period'>.</span><span class='id identifier rubyid_enable'><span class='object_link'><a href="Mongory/Utils/Debugger.html#enable-instance_method" title="Mongory::Utils::Debugger#enable (method)">enable</a></span></span>
<span class='id identifier rubyid_records'>records</span><span class='period'>.</span><span class='id identifier rubyid_mongory'>mongory</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:age</span> <span class='op'>=&gt;</span> <span class='int'>18</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_a'>to_a</span>
<span class='const'><span class='object_link'><a href="Mongory.html" title="Mongory (module)">Mongory</a></span></span><span class='period'>.</span><span class='id identifier rubyid_debugger'><span class='object_link'><a href="Mongory.html#debugger-class_method" title="Mongory.debugger (method)">debugger</a></span></span><span class='period'>.</span><span class='id identifier rubyid_display'><span class='object_link'><a href="Mongory/Utils/Debugger.html#display-instance_method" title="Mongory::Utils::Debugger#display (method)">display</a></span></span>
<span class='const'><span class='object_link'><a href="Mongory.html" title="Mongory (module)">Mongory</a></span></span><span class='period'>.</span><span class='id identifier rubyid_debugger'><span class='object_link'><a href="Mongory.html#debugger-class_method" title="Mongory.debugger (method)">debugger</a></span></span><span class='period'>.</span><span class='id identifier rubyid_disable'><span class='object_link'><a href="Mongory/Utils/Debugger.html#disable-instance_method" title="Mongory::Utils::Debugger#disable (method)">disable</a></span></span>
</code></pre></li>
<li><p><strong>Common Issues</strong></p>

<ul>
<li>Symbol snippets not working? Call <code>Mongory.enable_symbol_snippets!</code></li>
<li>Complex queries slow? Use <code>explain</code> to analyze</li>
<li>Memory issues? Consider pagination or streaming</li>
</ul></li>
</ol>

<h2 id="best-practices">Best Practices</h2>

<ol>
<li><p><strong>Query Composition</strong></p>

<pre class="code ruby"><code class="ruby"><span class='comment'># Good: Use method chaining
</span><span class='id identifier rubyid_records'>records</span><span class='period'>.</span><span class='id identifier rubyid_mongory'>mongory</span>
  <span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:age</span><span class='period'>.</span><span class='id identifier rubyid_gte'>gte</span> <span class='op'>=&gt;</span> <span class='int'>18</span><span class='rparen'>)</span>
  <span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:status</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>active</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='period'>.</span><span class='id identifier rubyid_limit'>limit</span><span class='lparen'>(</span><span class='int'>10</span><span class='rparen'>)</span>

<span class='comment'># Bad: Avoid redundant query creation
</span><span class='id identifier rubyid_query'>query</span> <span class='op'>=</span> <span class='id identifier rubyid_records'>records</span><span class='period'>.</span><span class='id identifier rubyid_mongory'>mongory</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:age</span><span class='period'>.</span><span class='id identifier rubyid_gte'>gte</span> <span class='op'>=&gt;</span> <span class='int'>18</span><span class='rparen'>)</span>
<span class='id identifier rubyid_query'>query</span> <span class='op'>=</span> <span class='id identifier rubyid_query'>query</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:status</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>active</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>  <span class='comment'># Unnecessary
</span></code></pre></li>
<li><p><strong>Performance Tips</strong></p>

<pre class="code ruby"><code class="ruby"># Use limit to restrict result set
records.mongory.limit(100).where(:age.gte =&gt; 18)

# Use fast mode for better performance
records.mongory.where(:age.gte =&gt; 18).fast

# Use explain to analyze complex queries
query = records.mongory.where(:$or =&gt; [...])
query.explain
</code></pre></li>
<li><p><strong>Code Organization</strong></p>

<pre class="code ruby"><code class="ruby"><span class='comment'># Encapsulate common queries as methods
</span><span class='kw'>class</span> <span class='const'>User</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_active_adults'>active_adults</span>
    <span class='id identifier rubyid_friends'>friends</span><span class='period'>.</span><span class='id identifier rubyid_mongory'>mongory</span>
      <span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:age</span><span class='period'>.</span><span class='id identifier rubyid_gte'>gte</span> <span class='op'>=&gt;</span> <span class='int'>18</span><span class='rparen'>)</span>
      <span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:status</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>active</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre></li>
</ol>

<h2 id="limitations">Limitations</h2>

<ol>
<li><p><strong>Data Size</strong></p>

<ul>
<li>Suitable for small to medium datasets</li>
<li>Large datasets may impact performance</li>
<li>Proc-based implementation helps with memory usage</li>
<li>Context system provides better resource management</li>
</ul></li>
<li><p><strong>Query Complexity</strong></p>

<ul>
<li>Complex queries may affect performance</li>
<li>Not all MongoDB operators are supported</li>
<li>Proc-based implementation improves complex query performance</li>
<li>Context system allows better control over query execution</li>
</ul></li>
<li><p><strong>Memory Usage</strong></p>

<ul>
<li>All operations are performed in memory</li>
<li>Consider memory constraints</li>
</ul></li>
</ol>

<h2 id="migration-guide">Migration Guide</h2>

<ol>
<li><p><strong>From Array#select</strong></p>

<pre class="code ruby"><code class="ruby"><span class='comment'># Before
</span><span class='id identifier rubyid_records'>records</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_r'>r</span><span class='op'>|</span> <span class='id identifier rubyid_r'>r</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>age</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>&gt;=</span> <span class='int'>18</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_r'>r</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>status</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>active</span><span class='tstring_end'>&#39;</span></span> <span class='rbrace'>}</span>

<span class='comment'># After
</span><span class='id identifier rubyid_records'>records</span><span class='period'>.</span><span class='id identifier rubyid_mongory'>mongory</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:age</span><span class='period'>.</span><span class='id identifier rubyid_gte'>gte</span> <span class='op'>=&gt;</span> <span class='int'>18</span><span class='comma'>,</span> <span class='label'>status:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>active</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
</code></pre></li>
<li><p><strong>From ActiveRecord</strong></p>

<pre class="code ruby"><code class="ruby"><span class='comment'># Before
</span><span class='id identifier rubyid_indexed_query'>indexed_query</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>age &gt;= ? AND status = ?</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>18</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>active</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

<span class='comment'># After
</span><span class='id identifier rubyid_indexed_query'>indexed_query</span><span class='period'>.</span><span class='id identifier rubyid_mongory'>mongory</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:age</span><span class='period'>.</span><span class='id identifier rubyid_gte'>gte</span> <span class='op'>=&gt;</span> <span class='int'>18</span><span class='comma'>,</span> <span class='label'>status:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>active</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
</code></pre></li>
<li><p><strong>From MongoDB</strong></p>

<pre class="code ruby"><code class="ruby"><span class='comment'># Before (MongoDB)
</span><span class='id identifier rubyid_users'>users</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:age</span><span class='period'>.</span><span class='id identifier rubyid_gte'>gte</span> <span class='op'>=&gt;</span> <span class='int'>18</span><span class='comma'>,</span> <span class='label'>status:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>active</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

<span class='comment'># After (Mongory)
</span><span class='id identifier rubyid_users'>users</span><span class='period'>.</span><span class='id identifier rubyid_mongory'>mongory</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='symbol'>:age</span><span class='period'>.</span><span class='id identifier rubyid_gte'>gte</span> <span class='op'>=&gt;</span> <span class='int'>18</span><span class='comma'>,</span> <span class='label'>status:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>active</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>

<span class='comment'># Just the same.
</span></code></pre></li>
</ol>

<h2 id="contributing">Contributing</h2>

<p>Contributions are welcome! Here&#39;s how you can help:</p>

<ol>
<li><strong>Fork the repository</strong>.</li>
<li><strong>Create a new branch</strong> for each significant change.</li>
<li><strong>Write tests</strong> for your changes.</li>
<li><strong>Send a pull request</strong>.</li>
</ol>

<p>Please ensure your code adheres to the project&#39;s style guide and that all tests pass before submitting.</p>

<h2 id="code-of-conduct">Code of Conduct</h2>

<p>Everyone interacting in the Mongory-rb project&#39;s codebases, issue trackers, chat rooms, and mailing lists is expected to follow the <a href="https://github.com/mongoryhq/mongory-rb/blob/main/CODE_OF_CONDUCT.md">code of conduct</a>.</p>

<h2 id="license">License</h2>

<p>MIT. See LICENSE file.</p>
</div></div>

      <div id="footer">
  Generated on Thu Apr 24 04:54:45 2025 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.37 (ruby-2.6.10).
</div>

    </div>
  </body>
</html>